/*
 * main.c
 *
 *  Author: Leonid T?igrinski
 */

#include <avr/io.h>
#include <avr/interrupt.h>
#include <stdio.h>

#include "main.h"
#include "button.h"
#include "ssd1306.h"
#include "joystcik.h"

uint8_t bitmap_logo[8192] =
{
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0xfc, 0xfb, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0xff, 0xdf, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0xff, 0xdf, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0xfe, 0xf9, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x7f, 0xc3, 0xf8, 0x3f, 0x1f, 0xf9, 0xf3, 0xe3, 0xf3, 0xf0, 0xf8, 0xff, 0xef, 0xfc, 0x00,
	0x00, 0xff, 0xe7, 0xfe, 0x3f, 0x1f, 0xfc, 0xf3, 0xc3, 0xfb, 0xf1, 0xf8, 0xff, 0xef, 0xfc, 0x00,
	0x00, 0xff, 0xef, 0xfe, 0x3f, 0x1f, 0xfc, 0xff, 0x83, 0xfb, 0xf1, 0xf8, 0xff, 0xef, 0xfc, 0x00,
	0x00, 0xff, 0xcf, 0x1f, 0x7f, 0x9e, 0x3c, 0x7f, 0x83, 0xff, 0xf1, 0xfc, 0x0f, 0xcf, 0xf8, 0x00,
	0x00, 0x7f, 0xef, 0x00, 0x7f, 0x9f, 0xfc, 0x3f, 0x03, 0xff, 0xf3, 0xfc, 0x1f, 0x8f, 0xf8, 0x00,
	0x00, 0x3f, 0xef, 0x1f, 0x77, 0x9f, 0xf8, 0x3f, 0x03, 0xff, 0xf3, 0xfe, 0x3e, 0x0f, 0xf8, 0x00,
	0x00, 0xff, 0xef, 0xfe, 0xff, 0xde, 0x78, 0x1e, 0x03, 0xdf, 0xf7, 0xfe, 0xff, 0xef, 0xfc, 0x00,
	0x00, 0xff, 0xef, 0xfe, 0xff, 0xde, 0x7c, 0x1e, 0x03, 0xde, 0xf7, 0xfe, 0xff, 0xef, 0xfc, 0x00,
	0x00, 0x3f, 0x83, 0xfd, 0xe3, 0xfe, 0x26, 0x1e, 0x03, 0xce, 0xf7, 0x8f, 0xff, 0xef, 0xfc, 0x00,
	0x00, 0x0c, 0x01, 0xe1, 0x83, 0x96, 0x27, 0x18, 0x03, 0x5a, 0x8c, 0x0c, 0x81, 0x68, 0x00, 0x00,
	0x00, 0x0c, 0x01, 0xe1, 0x83, 0x9e, 0x27, 0x18, 0x00, 0x42, 0x8c, 0x1c, 0x81, 0x68, 0x00, 0x00,
	0x00, 0x00, 0x01, 0xa0, 0x03, 0x0c, 0x23, 0x10, 0x00, 0x62, 0x80, 0x18, 0x81, 0x68, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x22, 0x00, 0x00, 0x02, 0x00, 0x00, 0x81, 0x68, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x08, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xe3, 0xe0, 0x0f, 0x1f, 0x9f, 0x80, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xf3, 0xe0, 0x0f, 0x8f, 0x9f, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0xfb, 0xe0, 0x1f, 0x87, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0xfb, 0xe0, 0x1f, 0xc7, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0xfb, 0xe0, 0x3f, 0xc3, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xf3, 0xe0, 0x3f, 0xc1, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xe3, 0xe0, 0x7f, 0xe1, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x03, 0xe0, 0x7f, 0xe0, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x03, 0xe0, 0x7f, 0xf0, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x03, 0xe0, 0xff, 0xf0, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x03, 0xff, 0xf9, 0xf0, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x03, 0xff, 0xf0, 0xf8, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};


#define ENABLE_DEBUG_LED \
	DDRD |= 1 << PORTD4; \
	PORTD |= 1 << PORTD4;
#define DISABLE_DEBUG_LED   \
	DDRD &= !(0 << PORTD4); \
	PORTD &= !(0 << PORTD4);

int main(void)
{
	ENABLE_DEBUG_LED;
	joystick_init();
	button_init();
	ssd1306_Init();
	ssd1306_Fill(Black);
	ssd1306_DrawBitmap(0, 0, bitmap_logo, 128, 64, White);
	ssd1306_UpdateScreen();
	
	/*
	ssd1306_DrawRectangle(10, 10, 20, 20, White);
	ssd1306_FillRectangle(30, 10, 40, 20, White);
	ssd1306_DrawCircle(50, 15, 5, White);
	ssd1306_FillCircle(70, 15, 5, White);
	
	ssd1306_SetCursor(10, 25);
	ssd1306_WriteString("Leonid", Font_6x8, White);
	ssd1306_SetCursor(10, 33);
	ssd1306_WriteString("Leonid", Font_7x10, White);
	ssd1306_SetCursor(10, 43);
	ssd1306_WriteString("Leonid", Font_11x18, White);
	//ssd1306_WriteString("Leonid", Font_16x26, White);
	
	ssd1306_DrawArc(115, 50, 10, 0, 180, White);
	ssd1306_DrawArcWithRadiusLine(115, 20, 10, 0, 180, White);
	
	ssd1306_SetContrast(0xFF);
	
	*/
	//ssd1306_UpdateScreen();
	
	//sei();
	
	char buff0[50];
	char buff1[50];
	
		
	while (1)
	{
		
		/*
		buttons_updateAll();
		
		uint16_t adc0 = joystcik_getX();
		
		snprintf(buff0, 50, "Joy x: %d   ", adc0);
		ssd1306_SetCursor(2, 2);
		ssd1306_WriteString(buff0, Font_6x8, White);
		
		uint16_t adc1 = joystcik_getY();
		
		snprintf(buff1, 50, "Joy y: %d   ", adc1);
		ssd1306_SetCursor(2, 12);
		ssd1306_WriteString(buff1, Font_6x8, White);
		*/
		/*
		ssd1306_FillCircle(16, 45, 5, White);
		ssd1306_FillCircle(48, 45, 5, White);
		ssd1306_FillCircle(80, 45, 5, White);
		ssd1306_FillCircle(112, 45, 5, White);
		
		
		
		if (button_getState1() == Button_Down)
		{
			ssd1306_FillCircle(16, 45, 4, White);
		}
		else
		{
			ssd1306_FillCircle(16, 45, 4, Black);
		}
		
		if (button_getState2() == Button_Down)
		{
			ssd1306_FillCircle(48, 45, 4, White);
		}
		else
		{
			ssd1306_FillCircle(48, 45, 4, Black);
		}
		
		if (button_getState3() == Button_Down)
		{
			ssd1306_FillCircle(80, 45, 4, White);
		}
		else
		{
			ssd1306_FillCircle(80, 45, 4, Black);
		}
		
		if (button_getState4() == Button_Down)
		{
			ssd1306_FillCircle(112, 45, 4, White);
		}
		else
		{
			ssd1306_FillCircle(112, 45, 4, Black);
		}
		*/
		
		//ssd1306_InverseColors();
		//ssd1306_UpdateScreen();
		//_delay_ms(1000);
		
		
		
	}
	

	return 0;
}